!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs/Observable"),require("rxjs/Subject"),require("rxjs/add/operator/mergeMap")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/Observable","rxjs/Subject","rxjs/add/operator/mergeMap"],t):t(e["ngx-uploader"]={},e.ng.core,e.Rx,e.Rx)}(this,function(e,t,n,r){"use strict";function s(e){if(0===e)return"0 Byte";var t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB","PB"][t]}var i={};i.Queue=0,i.Uploading=1,i.Done=2,i.Cancelled=3,i[i.Queue]="Queue",i[i.Uploading]="Uploading",i[i.Done]="Done",i[i.Cancelled]="Cancelled";var o=function(){function e(e,n){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=["*"]);var s=this;this.queue=[],this.serviceEvents=new t.EventEmitter,this.uploadScheduler=new r.Subject,this.subs=[],this.contentTypes=n,this.uploadScheduler.mergeMap(function(e){return s.startUpload(e)},e).subscribe(function(e){return s.serviceEvents.emit(e)})}return e.prototype.handleFiles=function(e){var t=this,n=[].reduce.call(e,function(e,n,r){if(t.isContentTypeAllowed(n.type))e=e.concat(n);else{var s=t.makeUploadFile(n,r);t.serviceEvents.emit({type:"rejected",file:s})}return e},[]);(r=this.queue).push.apply(r,[].map.call(n,function(e,n){var r=t.makeUploadFile(e,n);return t.serviceEvents.emit({type:"addedToQueue",file:r}),r})),this.serviceEvents.emit({type:"allAddedToQueue"});var r},e.prototype.initInputEvents=function(e){var t=this;return e.subscribe(function(e){switch(e.type){case"uploadFile":var n=t.queue.findIndex(function(t){return t===e.file});-1!==n&&e.file&&t.uploadScheduler.next({file:t.queue[n],event:e});break;case"uploadAll":t.queue.filter(function(e){return e.progress.status===i.Queue}).forEach(function(n){return t.uploadScheduler.next({file:n,event:e})});break;case"cancel":var r=e.id||null;if(!r)return;var s=t.subs.findIndex(function(e){return e.id===r});if(-1!==s&&t.subs[s].sub){t.subs[s].sub.unsubscribe();var o=t.queue.findIndex(function(e){return e.id===r});-1!==o&&(t.queue[o].progress.status=i.Cancelled,t.serviceEvents.emit({type:"cancelled",file:t.queue[o]}))}break;case"cancelAll":t.subs.forEach(function(e){e.sub&&e.sub.unsubscribe();var n=t.queue.find(function(t){return t.id===e.id});n&&(n.progress.status=i.Cancelled,t.serviceEvents.emit({type:"cancelled",file:n}))});break;case"remove":if(!e.id)return;var u=t.queue.findIndex(function(t){return t.id===e.id});if(-1!==u){var a=t.queue[u];t.queue.splice(u,1),t.serviceEvents.emit({type:"removed",file:a})}break;case"removeAll":t.queue.length&&(t.queue=[],t.serviceEvents.emit({type:"removedAll"}))}})},e.prototype.startUpload=function(e){var t=this;return new n.Observable(function(n){var r=t.uploadFile(e.file,e.event).subscribe(function(e){n.next(e)},function(e){n.error(e),n.complete()},function(){n.complete()});t.subs.push({id:e.file.id,sub:r})})},e.prototype.uploadFile=function(e,t){var r=this;return new n.Observable(function(n){var o=t.url||"",u=t.method||"POST",a=t.data||{},p=t.headers||{},l=new XMLHttpRequest,d=(new Date).getTime(),c=e.progress.data&&e.progress.data.startTime||d,f=0,h=null;l.upload.addEventListener("progress",function(t){if(t.lengthComputable){var o=Math.round(100*t.loaded/t.total),u=(new Date).getTime()-d;f=Math.round(t.loaded/u*1e3),c=e.progress.data&&e.progress.data.startTime||(new Date).getTime(),h=Math.ceil((t.total-t.loaded)/f),e.progress={status:i.Uploading,data:{percentage:o,speed:f,speedHuman:s(f)+"/s",startTime:c,endTime:null,eta:h,etaHuman:r.secondsToHuman(h)}},n.next({type:"uploading",file:e})}},!1),l.upload.addEventListener("error",function(e){n.error(e),n.complete()}),l.onreadystatechange=function(){if(l.readyState===XMLHttpRequest.DONE){var t=Math.round(e.size/((new Date).getTime()-c)*1e3);e.progress={status:i.Done,data:{percentage:100,speed:t,speedHuman:s(t)+"/s",startTime:c,endTime:(new Date).getTime(),eta:h,etaHuman:r.secondsToHuman(h||0)}},e.responseStatus=l.status;try{e.response=JSON.parse(l.response)}catch(o){e.response=l.response}e.responseHeaders=r.parseResponseHeaders(l.getAllResponseHeaders()),n.next({type:"done",file:e}),n.complete()}},l.open(u,o,!0),l.withCredentials=!!t.withCredentials;try{var v=e.nativeFile,m=r.queue.findIndex(function(e){return e.nativeFile===v});r.queue[m].progress.status===i.Cancelled&&n.complete(),Object.keys(a).forEach(function(t){return e.form.append(t,a[t])}),Object.keys(p).forEach(function(e){return l.setRequestHeader(e,p[e])}),e.form.append(t.fieldName||"file",v,v.name),r.serviceEvents.emit({type:"start",file:e}),l.send(e.form)}catch(y){n.complete()}return function(){l.abort()}})},e.prototype.secondsToHuman=function(e){return new Date(1e3*e).toISOString().substr(11,8)},e.prototype.generateId=function(){return Math.random().toString(36).substring(7)},e.prototype.setContentTypes=function(e){void 0!==e&&e instanceof Array?e.find(function(e){return"*"===e})!==undefined?this.contentTypes=["*"]:this.contentTypes=e:this.contentTypes=["*"]},e.prototype.allContentTypesAllowed=function(){return this.contentTypes.find(function(e){return"*"===e})!==undefined},e.prototype.isContentTypeAllowed=function(e){return!!this.allContentTypesAllowed()||this.contentTypes.find(function(t){return t===e})!==undefined},e.prototype.makeUploadFile=function(e,t){return{fileIndex:t,id:this.generateId(),name:e.name,size:e.size,type:e.type,form:new FormData,progress:{status:i.Queue,data:{percentage:0,speed:0,speedHuman:s(0)+"/s",startTime:null,endTime:null,eta:null,etaHuman:null}},lastModifiedDate:e.lastModifiedDate,sub:undefined,nativeFile:e}},e.prototype.parseResponseHeaders=function(e){if(e)return e.split("\n").map(function(e){return e.split(/: */,2)}).filter(function(e){return e[0]}).reduce(function(e,t){return e[t[0]]=t[1],e},{})},e}(),u=function(){function e(e){var n=this;this.elementRef=e,this.fileListener=function(){n.el.files&&n.upload.handleFiles(n.el.files)},this.uploadOutput=new t.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;this._sub=[];var n=this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,r=this.options&&this.options.allowedContentTypes||["*"];this.upload=new o(n,r),this.el=this.elementRef.nativeElement,this.el.addEventListener("change",this.fileListener,!1),this._sub.push(this.upload.serviceEvents.subscribe(function(t){e.uploadOutput.emit(t)})),this.uploadInput instanceof t.EventEmitter&&this._sub.push(this.upload.initInputEvents(this.uploadInput))},e.prototype.ngOnDestroy=function(){this.el.removeEventListener("change",this.fileListener,!1),this._sub.forEach(function(e){return e.unsubscribe()})},e}();u.decorators=[{type:t.Directive,args:[{selector:"[ngFileSelect]"}]}],u.ctorParameters=function(){return[{type:t.ElementRef}]},u.propDecorators={options:[{type:t.Input}],uploadInput:[{type:t.Input}],uploadOutput:[{type:t.Output}]};var a=function(){function e(e){this.elementRef=e,this.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},this.uploadOutput=new t.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;this._sub=[];var n=this.options&&this.options.concurrency||Number.POSITIVE_INFINITY,r=this.options&&this.options.allowedContentTypes||["*"];this.upload=new o(n,r),this.el=this.elementRef.nativeElement,this._sub.push(this.upload.serviceEvents.subscribe(function(t){e.uploadOutput.emit(t)})),this.uploadInput instanceof t.EventEmitter&&this._sub.push(this.upload.initInputEvents(this.uploadInput)),this.el.addEventListener("drop",this.stopEvent,!1),this.el.addEventListener("dragenter",this.stopEvent,!1),this.el.addEventListener("dragover",this.stopEvent,!1)},e.prototype.ngOnDestroy=function(){this._sub.forEach(function(e){return e.unsubscribe()})},e.prototype.onDrop=function(e){e.stopPropagation(),e.preventDefault();this.uploadOutput.emit({type:"drop"}),this.upload.handleFiles(e.dataTransfer.files)},e.prototype.onDragOver=function(e){if(e){this.uploadOutput.emit({type:"dragOver"})}},e.prototype.onDragLeave=function(e){if(e){this.uploadOutput.emit({type:"dragOut"})}},e}();a.decorators=[{type:t.Directive,args:[{selector:"[ngFileDrop]"}]}],a.ctorParameters=function(){return[{type:t.ElementRef}]},a.propDecorators={options:[{type:t.Input}],uploadInput:[{type:t.Input}],uploadOutput:[{type:t.Output}],onDrop:[{type:t.HostListener,args:["drop",["$event"]]}],onDragOver:[{type:t.HostListener,args:["dragover",["$event"]]}],onDragLeave:[{type:t.HostListener,args:["dragleave",["$event"]]}]};var p=function(){return function(){}}();p.decorators=[{type:t.NgModule,args:[{declarations:[u,a],exports:[u,a]}]}],p.ctorParameters=function(){return[]},e.NgUploaderModule=p,e.humanizeBytes=s,e.NgUploaderService=o,e.UploadStatus=i,e.NgFileSelectDirective=u,e.NgFileDropDirective=a,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-uploader.umd.min.js.map
